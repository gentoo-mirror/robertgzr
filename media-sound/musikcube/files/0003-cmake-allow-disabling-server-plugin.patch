From 7ead20dc3fd04511f91defc81db7159eff02776f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Robert=20G=C3=BCnzler?= <r@gnzler.io>
Date: Wed, 27 Oct 2021 12:36:32 +0200
Subject: [PATCH 3/5] cmake: allow disabling server plugin

removes hard dependency on libmicrohttp
---
 CMakeLists.txt | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 907917a..de2097b 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -127,7 +127,6 @@ add_subdirectory(src/musikcube)
 add_subdirectory(src/musikcubed)
 add_subdirectory(src/plugins/taglib_plugin)
 add_subdirectory(src/plugins/nullout)
-add_subdirectory(src/plugins/server)
 add_subdirectory(src/plugins/httpdatastream)
 add_subdirectory(src/plugins/stockencoders)
 add_subdirectory(src/plugins/supereqdsp)
@@ -170,7 +169,15 @@ endif()
 
 #end systemd / MPRIS detection
 
-add_dependencies(musikcube musikcore taglibreader nullout server httpdatastream stockencoders)
+if (${ENABLE_LIBMICROHTTP} MATCHES "false")
+  message(STATUS "[libmicrohttp] enabled = false")
+else()
+  message(STATUS "[libmicrohttp] enabled = true")
+  add_subdirectory(src/plugins/server)
+  add_dependencies(musikcube libmicrohttp server)
+endif()
+
+add_dependencies(musikcube musikcore taglibreader nullout httpdatastream stockencoders)
 add_dependencies(musikcubed musikcube)
 
 if (CMAKE_SYSTEM_NAME MATCHES "Linux")
-- 
2.32.0

